\chapter{Boundary Conditions for the $SP_N$ Equations\ }
\label{chap:spn_boundary_conditions}
We approach the formulation of the boundary conditions in much the
same way as for the $P_N$ equations with both reflecting and Marshak
conditions possible. To begin, we perform the expansion in
Eq~(\ref{eq:marshak_expanded}) for the left side of the planar system,
this time for $N=7$ to correspond to our $SP_7$ system. For $i=1$:
\begin{multline}
  \int_0^1 \mu \Bigg[ \phi_0 + 3\phi_1\mu +
    \frac{5}{2}\phi_2(3\mu^2-1) + \frac{7}{2}\phi_3(5\mu^3-3\mu)
    +\\ \frac{1}{8}(63\mu^5-70\mu^3+15\mu) \Bigg] d\mu = \int_0^1 \mu
  \phi_b d\mu\:,
  \label{eq:spn_bnd_p1}
\end{multline}
for $i=3$,
\begin{multline}
  \int_0^1 \frac{1}{2}(5\mu^3-3\mu) \Bigg[ \phi_0 + 3\phi_1\mu +
    \frac{5}{2}\phi_2(3\mu^2-1) + \frac{7}{2}\phi_3(5\mu^3-3\mu) +\\
    \frac{1}{8}(63\mu^5-70\mu^3+15\mu) \Bigg] d\mu = \int_0^1
  \frac{1}{2}(5\mu^3-3\mu) \phi_b d\mu\:,
  \label{eq:spn_bnd_p3}
\end{multline}
for $i=5$:
\begin{multline}
  \int_0^1 \frac{1}{8}(63\mu^5-70\mu^3+15\mu) \Bigg[ \phi_0 + 3\phi_1\mu +
    \frac{5}{2}\phi_2(3\mu^2-1) + \frac{7}{2}\phi_3(5\mu^3-3\mu) +\\
    \frac{1}{8}(63\mu^5-70\mu^3+15\mu) \Bigg] d\mu = \int_0^1
  \frac{1}{8}(63\mu^5-70\mu^3+15\mu) \phi_b d\mu\:,
  \label{eq:spn_bnd_p5}
\end{multline}
and for $i=7$:
\begin{multline}
  \int_0^1 \frac{1}{16}(429\mu^7-693\mu^5+315\mu^3+35\mu) \Bigg[
    \phi_0 + 3\phi_1\mu + \frac{5}{2}\phi_2(3\mu^2-1) +
    \frac{7}{2}\phi_3(5\mu^3-3\mu) \\+
    \frac{1}{8}(63\mu^5-70\mu^3+15\mu) +
    \frac{1}{16}(429\mu^7-693\mu^5+315\mu^3+35\mu) \Bigg] d\mu =\\
  \int_0^1 \frac{1}{16}(429\mu^7-693\mu^5+315\mu^3+35\mu) \phi_b
  d\mu\:.
  \label{eq:spn_bnd_p7}
\end{multline}
Carrying out the simple integrations yields the following system of
equations:
\begin{subequations}
  \begin{gather}
    \frac{1}{2}\phi_0 + \phi_1 + \frac{5}{8}\phi_2 -
    \frac{3}{16}\phi_4 + \frac{13}{128}\phi_6 =
    \frac{1}{2}\phi_{b}\\ -\frac{1}{8}\phi_0 + \frac{5}{8}\phi_2 +
    \phi_3 + \frac{81}{128}\phi_4 - \frac{13}{64}\phi_6 =
    -\frac{1}{8}\phi_{b}\\ \frac{1}{16}\phi_0 - \frac{25}{128}\phi_2 +
    \frac{81}{128}\phi_4 + \phi_5 + \frac{325}{512}\phi_6 =
    \frac{1}{16}\phi_{b}\\ -\frac{5}{128}\phi_0 + \frac{7}{64}\phi_2 -
    \frac{105}{512}\phi_4 + \frac{325}{512}\phi_6 + \phi_7 =
    -\frac{5}{128}\phi_{b}\:,
  \end{gather}
  \label{eq:spn_bnd_integrated}
\end{subequations}
where $\phi_b$ is again an isotropic source prescribed on the planar
boundary. For the odd moment in each boundary equation, we insert
Eq~(\ref{eq:odd_moments}) to remove them, leaving only the even
moments and a set of first-order differential equations:
\begin{subequations}
  \begin{gather}
    \frac{1}{2}\phi_0 + \frac{1}{3\Sigma_1}\frac{\partial}{\partial
      x}(\phi_0+2\phi_2) + \frac{5}{8}\phi_2 - \frac{3}{16}\phi_4 +
    \frac{13}{128}\phi_6 = \frac{1}{2}\phi_{b}\\ -\frac{1}{8}\phi_0 +
    \frac{5}{8}\phi_2 + \frac{1}{7\Sigma_3}\frac{\partial}{\partial
      x}(3\phi_2 + 4\phi_4) + \frac{81}{128}\phi_4 -
    \frac{13}{64}\phi_6 = -\frac{1}{8}\phi_{b}\\ \frac{1}{16}\phi_0 -
    \frac{25}{128}\phi_2 + \frac{81}{128}\phi_4 +
    \frac{1}{11\Sigma_5}\frac{\partial}{\partial x}(5\phi_4 + 6\phi_6)
    + \frac{325}{512}\phi_6 =
    \frac{1}{16}\phi_{b}\\ -\frac{5}{128}\phi_0 + \frac{7}{64}\phi_2 -
    \frac{105}{512}\phi_4 + \frac{325}{512}\phi_6 +
    \frac{1}{15\Sigma_7}\frac{\partial}{\partial x}(7\phi_6)
    = -\frac{5}{128}\phi_{b}\:.
  \end{gather}
  \label{eq:spn_bnd_subs}
\end{subequations}
We can again make the substitution of variables given by
Eqs~(\ref{eq:spn7_subs}) for consistency with the equations defined on
the domain. In addition, we apply the $SP_N$ approximation to the
derivatives by assuming they are instead multidimensional gradients on
the boundary such that $\frac{\partial}{\partial x} \rightarrow
\hat{\mathbf{n}}\cdot\nabla$. Doing this gives:
\begin{multline}
    \frac{1}{2}\Big(u_1 - \frac{2}{3}u_2 + \frac{8}{15}u_3 -
    \frac{16}{35}u_4\Big) +
    \frac{1}{3\Sigma_1}\hat{\mathbf{n}}\cdot\nabla\Big(\Big(u_1 -
    \frac{2}{3}u_2 + \frac{8}{15}u_3 -
    \frac{16}{35}u_4\Big)+\\2\Big(\frac{1}{3}u_2 - \frac{4}{15}u_3 +
    \frac{8}{35}u_4\Big)\Big) + \frac{5}{8}\Big(\frac{1}{3}u_2 -
    \frac{4}{15}u_3 + \frac{8}{35}u_4\Big)
    -\\ \frac{3}{16}\Big(\frac{1}{5}u_3 - \frac{6}{35}u_4\Big) +
    \frac{13}{128}\Big(\frac{1}{7}u_4\Big) = \frac{1}{2}\phi_{b}\:,
\end{multline}
\begin{multline}
    -\frac{1}{8}\Big(u_1 - \frac{2}{3}u_2 + \frac{8}{15}u_3 -
    \frac{16}{35}u_4\Big) + \frac{5}{8}\Big(\frac{1}{3}u_2 -
    \frac{4}{15}u_3 + \frac{8}{35}u_4\Big)
    +\\ \frac{1}{7\Sigma_3}\hat{\mathbf{n}}\cdot\nabla\Big
    (3\Big(\frac{1}{3}u_2 - \frac{4}{15}u_3 + \frac{8}{35}u_4\Big) +
    4\Big(\frac{1}{5}u_3 - \frac{6}{35}u_4\Big)\Big) +
    \frac{81}{128}\Big(\frac{1}{5}u_3 -\\ \frac{6}{35}u_4\Big) -
    \frac{13}{64}\Big(\frac{1}{7}u_4\Big) = -\frac{1}{8}\phi_{b}\:,
\end{multline}
\begin{multline}
    \frac{1}{16}\Big(u_1 - \frac{2}{3}u_2 + \frac{8}{15}u_3 -
    \frac{16}{35}u_4\Big) - \frac{25}{128}\Big(\frac{1}{3}u_2 -
    \frac{4}{15}u_3 +\\ \frac{8}{35}u_4\Big) +
    \frac{81}{128}\Big(\frac{1}{5}u_3 - \frac{6}{35}u_4\Big) +
    \frac{1}{11\Sigma_5}\hat{\mathbf{n}}\cdot\nabla\Big(5\Big(\frac{1}{5}u_3
    -\\ \frac{6}{35}u_4\Big) + 6\Big(\frac{1}{7}u_4\Big)\Big) +
    \frac{325}{512}\Big(\frac{1}{7}u_4\Big) = \frac{1}{16}\phi_{b}\:,
\end{multline}
\begin{multline}
    -\frac{5}{128}\Big(u_1 - \frac{2}{3}u_2 + \frac{8}{15}u_3 -
    \frac{16}{35}u_4\Big) + \frac{7}{64}\Big(\frac{1}{3}u_2 -
    \frac{4}{15}u_3 + \frac{8}{35}u_4\Big)
    -\\ \frac{105}{512}\Big(\frac{1}{5}u_3 - \frac{6}{35}u_4\Big) +
    \frac{325}{512}\Big(\frac{1}{7}u_4\Big)
    +\\ \frac{1}{15\Sigma_7}\hat{\mathbf{n}}
    \cdot\nabla\Big(7\Big(\frac{1}{7}u_4\Big)\Big) =
    -\frac{5}{128}\phi_{b}\:.
\end{multline}
By rearranging the system such that we have a single gradient operator
in each equation, we again have a matrix system:
\begin{equation}
  \mathbf{n} \cdot D_n \nabla u_n + \sum_{m=1}^4 B_{nm} u_m =
  s_n\ \ \ \ \ \ \ n = 1,2,3,4\:,
  \label{eq:spn_bnd_matrix}
\end{equation}
where $\mathbf{D}$ and $\mathbf{u}$ are defined as before and:
\begin{equation}
  \mathbf{s} = \Big(\frac{1}{2}\phi_b\ -\frac{1}{8}\phi_b\
  \frac{1}{16}\phi_b\ -\frac{5}{128}\phi_b \Big)^T\:,
  \label{eq:spn_bnd_source}
\end{equation}
is the source vector on the boundary and
%% I grabbed this matrix from Tom's tech note again.
\begin{equation}
  \mathbf{B} = \begin{bmatrix}
    \frac{1}{2} &
    -\frac{1}{8} &
    \frac{1}{16} &
    -\frac{5}{128} \\
    %%
    &&&\\
    %%
    -\frac{1}{8} &
    \frac{7}{24} &
    -\frac{41}{384} &
    \frac{1}{16} \\
    %%
    &&&\\
    %%
    \frac{1}{16} &
    -\frac{41}{384} &
    \frac{407}{1920} &
    -\frac{233}{2560} \\
    %%
    &&&\\
    %%
    -\frac{5}{128} &
    \frac{1}{16} &
    -\frac{233}{2560} &
    \frac{3023}{17920}
  \end{bmatrix}\:,
  \label{eq:B_matrix}
\end{equation}
is a dense matrix of coefficients. Again, as pointed out by Evans, the
$SP_1$ approximation reduces this boundary condition to the standard
Marshak diffusion boundary condition. For reflecting boundary
conditions, we use the same procedure as the $P_N$ equations where the
odd-moments are zero such that Eq~(\ref{eq:reflecting_condition}) is
true. From setting Eq~(\ref{eq:odd_moments}) to zero for odd $\phi_n$
and again substituting Eq~(\ref{eq:spn7_subs}) we immediately find
that:
\begin{equation}
  \nabla \mathbf{u} = 0
  \label{eq:spn_reflecting}
\end{equation}
for reflecting $SP_N$ boundaries, providing enough equations to close
the system.

Analogously, for Marshak conditions on the boundaries of the
multigroup problem we have:
\begin{equation}
  \hat{\mathbf{n}} \cdot \mathbb{D}_n \nabla \mathbb{U}_n +
  \sum_{m=1}^4 \mathbb{B}_{nm} \mathbb{U}_m = \mathbb{S}_n\:,
  \label{eq:spn_multigroup_bnd}
\end{equation}
with $\mathbb{S}_n$ the vector of group-wise boundary source term on
each boundary for each psuedo-moment and $\mathbb{B}_{nm}$ is an $N_g
\times N_g$ diagonal matrix with the value $B_{nm}$ on the
diagonal. For reflecting conditions, again we have $\nabla
\mathbb{U}_n = 0$ for all pseudo-moments.
